Usage: source websocket
Websocket connection and functions

This script needs to be sourced to work properly
The avaliable functions are listed below

ws-start
    Starts the ws connection and dispatch the events
    using MASH_DISPATCH_{EVENT} environment variables

ws-send {OP_CODE} [SHARD]
    Sends the JSON data from the STDIN to the gateway
        OP_CODE: The opcode for the operation
        SHARD: The shard that will send it, default is 0

ws-kill {SHARD}
    Kills a shard that will automatically restart
        SHARD: The shard that will be killed

dispatch {EVENT} {FUNCTION}
    Defines a event dispatch route
    EVENT: The name of the event
    FUNCTION: The name of the function

ewait {CONDITION} [TIMEOUT] [SHARD]
    Watches the log until it finds a event that meet
    the jq condition, and outputs it
        CONDITION: A Jq string that returns a boolean
        TIMEOUT: In seconds, 0 for never expire
        SHARD: Shard number or nothing for all shards

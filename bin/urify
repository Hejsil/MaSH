#!/bin/bash
if [ -z "$1" ]; then
	echo "Usage: urify {KEY}"
	echo "Opens the filepath on a JSON value, and converts it to a URI scheme. Accept a JSON string on STDIN"
	exit 1
fi

read -r TEXT

IMAGE=$(echo "$TEXT" | jq -r ".$1")
MIME=$(file -bN --mime-type "$IMAGE")
echo "data:$MIME;base64,$(base64 -w 0 "$IMAGE")" > "$IMAGE.b64"
TEXT=$(echo "$TEXT" | jq --rawfile img "$IMAGE.b64" ".$1 = \$img")
rm "$IMAGE.b64"
echo "$TEXT"

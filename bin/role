#!/bin/bash

case $1 in
'new'|'edit'|'del'|'list'|'give'|'take'|'pos_edit')
	read -r TEXT
	GUILD=$(echo "$TEXT" | jq -r ".guild")
	case $1 in
	'new')
		PAYLOAD=$(echo "$TEXT" | filter-args json "name,permissions,color,hoist,mentionable")
		echo "$PAYLOAD" | dapi POST "/guilds/$GUILD/roles" ;;
	'edit')
		ROLE=$(echo "$TEXT"| jq -r ".id")
		PAYLOAD=$(echo "$TEXT" | filter-args json "name,permissions,color,hoist,mentionable")
		echo "$PAYLOAD" | dapi PATCH "/guilds/$GUILD/roles/$ROLE" ;;
	'del')
		ROLE=$(echo "$TEXT"| jq -r ".id")
		echo " " | dapi DELETE "/guilds/$GUILD/roles/$ROLE" ;;
	'list')
		echo " " | dapi GET "/guilds/$GUILD/roles" ;;
	'give')
		ROLE=$(echo "$TEXT"| jq -r ".id"); USER=$(echo "$TEXT"| jq -r ".user")
		echo " " | dapi PUT "/guilds/$GUILD/members/$USER/roles/$ROLE" ;;
	'take')
		ROLE=$(echo "$TEXT"| jq -r ".id"); USER=$(echo "$TEXT"| jq -r ".user")
		echo " " | dapi DELETE "/guilds/$GUILD/members/$USER/roles/$ROLE" ;;
	'pos_edit')
		PAYLOAD=$(echo "$TEXT" | jq '.data')
		echo "$PAYLOAD" | dapi PATCH "/guild/$GUILD/roles" ;;
	esac ;;
*)
	echo "Usage: role {COMMAND}" >&2
	echo "Interacts with role endpoints"
	echo ""
	echo "Every command accept a string of JSON on STDIN"
       	echo "Avaliable commands with their respective JSON keys"
	echo ""
	echo "new: {guild} [name] [permissions] [color] [hoist] "
	echo "[mentionable]"
	echo "    guild: (snowflake) the id of the guild"
	echo "    name: (string) the name of the role"
	echo "    permissions: (integer) bitwise value of the "
	echo "        enabled/disabled permissions"
	echo "    color: (integer) RGB color"
	echo "    hoist: (boolean) whether the role is hoisted"
	echo "    mentionable: (boolean) whether the role is "
	echo "        mentionable"
	echo ""
	echo "edit: {id} {guild} [name] [permissions] [color] "
	echo "[hoist] [mentionable]"
	echo "    id: (snowflake) the id of the role"
	echo "    guild: (snowflake) the id of the guild"
	echo "    name: (string) the name of the role"
	echo "    permissions: (integer) bitwise value of the "
	echo "        enabled/disabled permissions"
	echo "    color: (integer) RGB color"
	echo "    hoist: (boolean) whether the role is hoisted"
	echo "    mentionable: (boolean) whether the role is "
	echo "        mentionable"
	echo ""
	echo "del: {id} {guild}"
	echo "    id: (snowflake) the id of the role"
	echo "    guild: (snowflake) the id of the guild"
	echo ""
	echo "list: {guild}"
	echo "    guild: (snowflake) the id of the guild"
	echo ""
	echo "give: {id} {user} {guild}"
	echo "    id: (snowflake) the id of the role"
	echo "    user: (snowflake) the id of the user"
	echo "    guild: (snowflake) the id of the guild"
	echo ""
	echo "take: {id} {user} {guild}"
	echo "    id: (snowflake) the id of the role"
	echo "    user: (snowflake) the id of the user"
	echo "    guild: (snowflake) the id of the guild"
	echo ""
	echo "pos_edit: {guild} {data}"
	echo "    guild: (snowflake) the id of the target guild"
	echo "    data: (array) an array of (snowflake, integer), containing the role id"
	echo "        and the position"
	exit 1 ;;
esac

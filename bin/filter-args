#!/bin/bash
case $1 in
'json')
	echo "$2" | jq "{$3} | with_entries(select(.value!=null))" ;;
'query')
	ARGS=$(./$0 json "$2" "$3" | jq -r 'keys[] as $k | "\($k)=\(.[$k])"' | awk 'ORS="&"' | head -c -1)
	[ -z "$ARGS" ] || echo "?$ARGS"	;;
*)
	echo "Usage: filter-args {OUTPUT_FORMAT} {DATA} {ARGSTRING}"
	echo "Filter unwanted args and returns only the specified"
esac

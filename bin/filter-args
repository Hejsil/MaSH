#!/bin/bash
case $1 in 
'json'|'query')
	read -r PAYLOAD
	case $1 in
	'json')
		ARGS=$(echo "$PAYLOAD" | jq -cM "{$2} | with_entries(select(.value!=null))")
		[ -n "$ARGS" ] && echo "$ARGS" || echo '{}' ;;
	'query')
		ARGS=$($0 json "$PAYLOAD" "$2" | jq -r 'keys[] as $k | "\($k)=\(.[$k])"' | awk 'ORS="&"' | head -c -1)
		[ -z "$ARGS" ] || echo "?$ARGS"	;;
	esac;;
*)
	echo "Usage: filter-args {OUTPUT_FORMAT} {ARGSTRING}" >&2
	echo "Filter unwanted args from STDIN and returns only the specified to STDOUT"
esac

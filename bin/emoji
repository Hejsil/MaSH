#!/bin/bash

case $1 in
'get'|'new'|'edit'|'del'|'list')
	read -r TEXT
	GUILD=$(echo "$TEXT" | jq -r ".guild")
	case $1 in
	'get')
		EMOJI=$(echo "$TEXT" | jq -r ".id")
		echo "{}" | dapi GET "/guilds/$GUILD/emojis/$EMOJI" ;;
	'new')
		PAYLOAD=$(echo "$TEXT" | filter-args json 'name,image,roles')
		echo "$PAYLOAD" | dapi POST "/guilds/$GUILD/emojis" ;;
	'edit')
		EMOJI=$(echo "$TEXT" | jq -r ".id")
		PAYLOAD=$(echo "$TEXT" | filter-args json 'name,roles')
		echo "$PAYLOAD" | dapi PATCH "/guilds/$GUILD/emojis/$EMOJI" ;;
	'del')
		EMOJI=$(echo "$TEXT" | jq -r ".id")
		echo "{}" | dapi DELETE "/guilds/$GUILD/emojis/$EMOJI" ;;
	'list')
		echo "{}" | dapi GET "/guilds/$GUILD/emojis" ;;
	esac ;;
*)
	echo "Usage: emoji {COMMAND} {JSON}" >&2
	echo "Interacts with emoji endpoints"
	echo ""
	echo "Every command accepts a string of JSON, as stdout or arg"
       	echo "Avaliable commands with their respective JSON keys:"
	echo ""
	echo "get: {id} {guild}"
	echo "    id: (snowflake) the id of the emoji"
	echo "    guild: (snowflake) the target guild"
	echo ""
	echo "new: {guild} {name} {image} {roles}"
	echo "    guild: (snowflake) the target guild"
	echo "    name: (string) name of the emoji"
	echo "    image: (uri image) the data of the 128x128 image"
	echo "    roles: (array) roles for which the emoji will be whitelisted"
	echo ""
	echo "edit: {id} {guild} {name} {roles}"
	echo "    id: (snowflake) the id of the emoji"
	echo "    guild: (snowflake) the target guild"
	echo "    name: (string) name of the emoji"
	echo "    roles: (array) roles for which the emoji will be whitelisted"
	echo ""
	echo "del: {id} {emoji}"
	echo "    id: (snowflake) the id of the emoji"
	echo "    guild: (snowflake) the target guild"
	echo ""
	echo "list: {guild}"
	echo "    guild: (snowflake) the target guild"
	echo ""
	exit 1 ;;
esac
